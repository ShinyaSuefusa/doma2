

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SQL &mdash; Doma 2.0 ドキュメント</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Doma 2.0 ドキュメント" href="index.html"/>
        <link rel="next" title="式言語" href="expression.html"/>
        <link rel="prev" title="クエリビルダ" href="query-builder/index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Doma
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">設定</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic.html">基本型</a></li>
<li class="toctree-l1"><a class="reference internal" href="domain.html">ドメインクラス</a></li>
<li class="toctree-l1"><a class="reference internal" href="entity.html">エンティティクラス</a></li>
<li class="toctree-l1"><a class="reference internal" href="dao.html">Daoインタフェース</a></li>
<li class="toctree-l1"><a class="reference internal" href="query/index.html">クエリ</a></li>
<li class="toctree-l1"><a class="reference internal" href="query-builder/index.html">クエリビルダ</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">SQL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">SQL テンプレート</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">アノテーション</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">SQLファイル</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">エンコーディング</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">配置場所</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">ファイル名の形式</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id8">SQL コメント</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9">バインド変数コメント</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id10">基本型もしくはドメインクラス型のパラメータ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#iterable">Iterable型のパラメータ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">任意の型のパラメータ</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id12">埋め込み変数コメント</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">条件コメント</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ifend">ifとend</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wherehaving">条件コメントにおけるWHEREやHAVINGの自動除去</a></li>
<li class="toctree-l4"><a class="reference internal" href="#andor">条件コメントにおけるANDやORの自動除去</a></li>
<li class="toctree-l4"><a class="reference internal" href="#elseifelse">elseifとelse</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">ネストした条件コメント</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">条件コメントにおける制約</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id16">繰り返しコメント</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#forend">forとend</a></li>
<li class="toctree-l4"><a class="reference internal" href="#item-has-nextitem-index">item_has_nextとitem_index</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id17">繰り返しコメントにおけるWHEREやHAVINGの自動除去</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id18">繰り返しコメントにおけるANDやORの自動除去</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id19">繰り返しコメントにおける制約</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id20">選択カラムリスト展開コメント</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#expand">expand</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#populate">更新カラムリスト生成コメント</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id22">populate</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id23">通常のブロックコメント</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id24">通常の行コメント</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="expression.html">式言語</a></li>
<li class="toctree-l1"><a class="reference internal" href="transaction.html">トランザクション</a></li>
<li class="toctree-l1"><a class="reference internal" href="annotation-processing.html">注釈処理</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">ビルド</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="development.html">Doma の開発</a></li>
<li class="toctree-l1"><a class="reference internal" href="integration-test.html">統合テスト</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release-notes.html">リリースノート</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Doma 2 における主要な変更点</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Doma</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>SQL</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/sql.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sql">
<h1><a class="toc-backref" href="#id25">SQL</a><a class="headerlink" href="#sql" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="contents topic" id="id1">
<p class="topic-title first">目次</p>
<ul class="simple">
<li><a class="reference internal" href="#sql" id="id25">SQL</a><ul>
<li><a class="reference internal" href="#id2" id="id26">SQL テンプレート</a></li>
<li><a class="reference internal" href="#id3" id="id27">アノテーション</a></li>
<li><a class="reference internal" href="#id4" id="id28">SQLファイル</a><ul>
<li><a class="reference internal" href="#id5" id="id29">エンコーディング</a></li>
<li><a class="reference internal" href="#id6" id="id30">配置場所</a></li>
<li><a class="reference internal" href="#id7" id="id31">ファイル名の形式</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id8" id="id32">SQL コメント</a><ul>
<li><a class="reference internal" href="#id9" id="id33">バインド変数コメント</a></li>
<li><a class="reference internal" href="#id12" id="id34">埋め込み変数コメント</a></li>
<li><a class="reference internal" href="#id13" id="id35">条件コメント</a></li>
<li><a class="reference internal" href="#id16" id="id36">繰り返しコメント</a></li>
<li><a class="reference internal" href="#id20" id="id37">選択カラムリスト展開コメント</a></li>
<li><a class="reference internal" href="#populate" id="id38">更新カラムリスト生成コメント</a></li>
<li><a class="reference internal" href="#id23" id="id39">通常のブロックコメント</a></li>
<li><a class="reference internal" href="#id24" id="id40">通常の行コメント</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id26">SQL テンプレート</a><a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>SQL は SQL テンプレートを使用して記述します。</p>
<p>SQL テンプレートの文法は SQL のブロックコメント <code class="docutils literal"><span class="pre">/*</span> <span class="pre">*/</span></code> をベースにしたもので
あるため1つのテンプレートは次の2つの方法で使用できます。</p>
<ul class="simple">
<li>Doma でテンプレートの文法を解釈し動的にSQLを組み立てて実行する</li>
<li>SQL のツールでテンプレートの文法はコメントアウトされたものとして
静的な SQL を実行する</li>
</ul>
<p>この特徴は <strong>2-way SQL</strong> と呼ばれることがあります。</p>
<p>SQL テンプレートはファイルに記述してDaoのメソッドにマッピングする必要があります。</p>
<p>たとえば、 SQL ファイルには次のような SQL テンプレートを格納します。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span> <span class="n">employee_id</span> <span class="o">=</span> <span class="cm">/* employeeId */</span><span class="mi">99</span>
</pre></div>
</div>
<p>ここでは、ブロックコメントで囲まれた <code class="docutils literal"><span class="pre">employeeId</span></code> がDaoインタフェースのメソッドのパラメータに対応し、
直後の <code class="docutils literal"><span class="pre">99</span></code> はテスト用のデータになります。
テスト用のデータは、 Doma に解釈されて実行される場合には使用されません。
SQL のツールによる静的な実行時にのみ使用されます。</p>
<p>対応するDaoインタフェースのメソッドは次のとおりです。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Employee</span> <span class="nf">selectById</span><span class="o">(</span><span class="n">employeeId</span><span class="o">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id27">アノテーション</a><a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>SQLファイルとDaoのメソッドのマッピングは次のアノテーションで示します。</p>
<ul class="simple">
<li>&#64;Select</li>
<li>&#64;Insert(sqlFile = true)</li>
<li>&#64;Update(sqlFile = true)</li>
<li>&#64;Delete(sqlFile = true)</li>
<li>&#64;BatchInsert(sqlFile = true)</li>
<li>&#64;BatchUpdate(sqlFile = true)</li>
<li>&#64;BaatchDelete(sqlFile = true)</li>
</ul>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id28">SQLファイル</a><a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id29">エンコーディング</a><a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>SQLファイルのエンコーディングはUTF-8でなければいけません。</p>
</div>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id30">配置場所</a><a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>SQLファイルはクラスパスが通った META-INF ディレクトリ以下に配置しなければいけません。</p>
</div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id31">ファイル名の形式</a><a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>ファイル名は、次の形式でなければいけません。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>META-INF/Daoのクラスの完全修飾名をディレクトリに変換したもの/Daoのメソッド名.sql
</pre></div>
</div>
<p>例えば、 Daoのクラスが <code class="docutils literal"><span class="pre">aaa.bbb.EmployeeDao</span></code> でマッピングしたいメソッドが
<code class="docutils literal"><span class="pre">selectById</span></code> の場合、パス名は次のようになります。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">META</span><span class="o">-</span><span class="n">INF</span><span class="o">/</span><span class="n">aaa</span><span class="o">/</span><span class="n">bbb</span><span class="o">/</span><span class="n">EmployeeDao</span><span class="o">/</span><span class="n">selectById</span><span class="o">.</span><span class="n">sql</span>
</pre></div>
</div>
<p>複数の RDBMS を使用する環境下で特定の RDBMS では別の SQL ファイルを使いたい場合、
拡張子 <code class="docutils literal"><span class="pre">.sql</span></code> の前にハイフン区切りで RDBMS 名を入れることで、
優先的に使用するファイルを指示できます。
たとえば、PostgreSQL専用のSQLファイルは次の名前にします。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">META</span><span class="o">-</span><span class="n">INF</span><span class="o">/</span><span class="n">aaa</span><span class="o">/</span><span class="n">bbb</span><span class="o">/</span><span class="n">EmployeeDao</span><span class="o">/</span><span class="n">selectById</span><span class="o">-</span><span class="n">postgres</span><span class="o">.</span><span class="n">sql</span>
</pre></div>
</div>
<p>この例ではPostgreSQLを使用している場合に限り、 <code class="docutils literal"><span class="pre">META-INF/aaa/bbb/EmployeeDao/selectById.sql</span></code>
よりも <code class="docutils literal"><span class="pre">META-INF/aaa/bbb/EmployeeDao/selectById-postgres.sql</span></code> が優先的に使用されます。</p>
<p>RDBMS 名は、 <code class="docutils literal"><span class="pre">Dialect</span></code> の <code class="docutils literal"><span class="pre">getName</span></code> メソッドの値が使用されます。
あらかじめ用意された <code class="docutils literal"><span class="pre">Dialect</span></code> についてそれぞれの RDBMS 名を以下の表に示します。</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="32%" />
<col width="18%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">データベース</th>
<th class="head">Dialect</th>
<th class="head">RDBMS 名</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>DB2</td>
<td>Db2Dialect</td>
<td>db2</td>
</tr>
<tr class="row-odd"><td>H2 Database Engine 1.2.126</td>
<td>H212126Dialect</td>
<td>h2</td>
</tr>
<tr class="row-even"><td>H2 Database</td>
<td>H2Dialect</td>
<td>h2</td>
</tr>
<tr class="row-odd"><td>HSQLDB</td>
<td>HsqldbDialect</td>
<td>hsqldb</td>
</tr>
<tr class="row-even"><td>Microsoft SQL Server 2008</td>
<td>Mssql2008Dialect</td>
<td>mssql</td>
</tr>
<tr class="row-odd"><td>Microsoft SQL Server</td>
<td>MssqlDialect</td>
<td>mssql</td>
</tr>
<tr class="row-even"><td>MySQL</td>
<td>MySqlDialect</td>
<td>mysql</td>
</tr>
<tr class="row-odd"><td>Oracle Database</td>
<td>OracleDialect</td>
<td>oracle</td>
</tr>
<tr class="row-even"><td>PostgreSQL</td>
<td>PostgresDialect</td>
<td>postgres</td>
</tr>
<tr class="row-odd"><td>SQLite</td>
<td>SqliteDialect</td>
<td>sqlite</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id8">
<h2><a class="toc-backref" href="#id32">SQL コメント</a><a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>SQL コメント中に式を記述することで値のバインディングや条件分岐を行います。
Doma に解釈されるSQLコメントを <em>式コメント</em> と呼びます。</p>
<p>式コメントには以下のものがあります。</p>
<ul class="simple">
<li><a class="reference internal" href="#id9">バインド変数コメント</a></li>
<li><a class="reference internal" href="#id12">埋め込み変数コメント</a></li>
<li><a class="reference internal" href="#id13">条件コメント</a></li>
<li><a class="reference internal" href="#id16">繰り返しコメント</a></li>
<li><a class="reference internal" href="#id20">選択カラムリスト展開コメント</a></li>
<li><a class="reference internal" href="#id21">更新カラムリスト生成コメント</a></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">式コメントに記述できる式の文法については <a class="reference internal" href="expression.html"><em>式言語</em></a> を参照してください。</p>
</div>
<div class="section" id="id9">
<h3><a class="toc-backref" href="#id33">バインド変数コメント</a><a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>バインド変数を示す式コメントを <em>バインド変数</em> コメントと呼びます。
バインド変数は、 <code class="docutils literal"><span class="pre">java.sql.PreparedStatement</span></code> を介してSQLに設定されます。</p>
<p>バインド変数は <code class="docutils literal"><span class="pre">/*～*/</span></code> というブロックコメントで囲んで示します。
バインド変数の名前はDaoメソッドのパラメータ名に対応します。
対応するパラメータの型は <a class="reference internal" href="basic.html"><em>基本型</em></a> もしくは <a class="reference internal" href="domain.html"><em>ドメインクラス</em></a> でなければいけません。
バインド変数コメントの直後にはテスト用データを指定する必要があります。
ただし、テスト用データは実行時には使用されません。</p>
<div class="section" id="id10">
<h4>基本型もしくはドメインクラス型のパラメータ<a class="headerlink" href="#id10" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>Dao インタフェースのメソッドのパラメータが <a class="reference internal" href="basic.html"><em>基本型</em></a> もしくは <a class="reference internal" href="domain.html"><em>ドメインクラス</em></a> の場合、
このパラメータは1つのバインド変数を表現できます。
バインド変数コメントはバインド変数を埋め込みたい場所に記述し、
バインド変数コメントの直後にはテスト用データを指定しなければいけません。
Dao インタフェースのメソッドと対応する SQL の例は次のとおりです。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Employee</span> <span class="nf">selectById</span><span class="o">(</span><span class="n">Integer</span> <span class="n">employeeId</span><span class="o">);</span>
</pre></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span> <span class="n">employee_id</span> <span class="o">=</span> <span class="cm">/* employeeId */</span><span class="mi">99</span>
</pre></div>
</div>
</div>
<div class="section" id="iterable">
<h4>Iterable型のパラメータ<a class="headerlink" href="#iterable" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>Dao インタフェースのメソッドのパラメータが <code class="docutils literal"><span class="pre">java.lang.Iterable</span></code> のサブタイプの場合、
このパラメータは、 IN句内の複数のバインド変数を表現できます。
ただし、 <code class="docutils literal"><span class="pre">java.lang.Iterable</span></code> のサブタイプの実型引数は <a class="reference internal" href="basic.html"><em>基本型</em></a> もしくは <a class="reference internal" href="domain.html"><em>ドメインクラス</em></a> でなければいけません。
バインド変数コメントはINキーワードの直後に置き、
バインド変数コメントの直後には括弧つきでテスト用データを指定しなければいけません。
Dao インタフェースのメソッドと対応する SQL の例は次のとおりです。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="nf">selectByIdList</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">employeeIdList</span><span class="o">);</span>
</pre></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span> <span class="n">employee_id</span> <span class="k">in</span> <span class="cm">/* employeeIdList */</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">Iterable</span></code> が空であるとき、IN句の括弧内の値は <code class="docutils literal"><span class="pre">null</span></code> になります。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span> <span class="n">employee_id</span> <span class="k">in</span> <span class="p">(</span><span class="k">null</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h4>任意の型のパラメータ<a class="headerlink" href="#id11" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>Dao インタフェースのメソッドのパラメータが <a class="reference internal" href="basic.html"><em>基本型</em></a> もしくは <a class="reference internal" href="domain.html"><em>ドメインクラス</em></a> でない場合、
パラメータは複数のバインド変数コメントに対応します。
バインド変数コメントの中では、ドット <code class="docutils literal"><span class="pre">.</span></code> を使用し任意の型のフィールドやメソッドにアクセスできます。
Dao インタフェースのメソッドと対応する SQL の例は次のとおりです。</p>
<p><code class="docutils literal"><span class="pre">EmployeeDto</span></code> クラスには、 <code class="docutils literal"><span class="pre">employeeName</span></code> フィールドや <code class="docutils literal"><span class="pre">salary</span></code> フィールドが存在するものとします。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="nf">selectByNameAndSalary</span><span class="o">(</span><span class="n">EmployeeDto</span> <span class="n">dto</span><span class="o">);</span>
</pre></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span>
<span class="k">where</span>
<span class="n">employee_name</span> <span class="o">=</span> <span class="cm">/* dto.employeeName */</span><span class="s1">&#39;abc&#39;</span>
<span class="k">and</span>
<span class="n">salary</span> <span class="o">=</span> <span class="cm">/* dto.salary */</span><span class="mi">1234</span>
</pre></div>
</div>
<p>フィールドにアクセスする代わりに <code class="docutils literal"><span class="pre">public</span></code> なメソッドを呼び出すことも可能です。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span>
<span class="k">where</span>
<span class="n">salary</span> <span class="o">=</span> <span class="cm">/* dto.getTaxedSalary() */</span><span class="mi">1234</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id12">
<h3><a class="toc-backref" href="#id34">埋め込み変数コメント</a><a class="headerlink" href="#id12" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>埋め込み変数を示す式コメントを埋め込み変数コメントと呼びます。
埋め込み変数の値は SQL を組み立てる際に SQL の一部として直接埋め込まれます。</p>
<p>SQL インジェクションを防ぐため、埋め込み変数の値に以下の値を含めることは禁止しています。</p>
<ul class="simple">
<li>シングルクォテーション</li>
<li>セミコロン</li>
<li>行コメント</li>
<li>ブロックコメント</li>
</ul>
<p>埋め込み変数は <code class="docutils literal"><span class="pre">/*#～*/</span></code> というブロックコメントで示します。
埋め込み変数の名前は Dao メソッドのパラメータ名にマッピングされます。
埋め込み変数は <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></code> 句など SQL の一部をプログラムで組み立てたい場合に使用できます。
Dao のメソッドと対応する SQL の例は次のとおりです。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="nf">selectAll</span><span class="o">(</span><span class="n">BigDecimal</span> <span class="n">salary</span><span class="o">,</span> <span class="n">String</span> <span class="n">orderyBy</span><span class="o">);</span>
</pre></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span> <span class="n">salary</span> <span class="o">&gt;</span> <span class="cm">/* salary */</span><span class="mi">100</span> <span class="cm">/*# orderBy */</span>
</pre></div>
</div>
<p>Dao の呼び出し例は次の通りです。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">EmployeeDao</span> <span class="n">dao</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EmployeeDaoImpl</span><span class="o">();</span>
<span class="n">BigDecimal</span> <span class="n">salary</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigDecimal</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
<span class="n">String</span> <span class="n">orderBy</span> <span class="o">=</span> <span class="s">&quot;order by salary asc, employee_name&quot;</span><span class="o">;</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">selectAll</span><span class="o">(</span><span class="n">salary</span><span class="o">,</span> <span class="n">orderBy</span><span class="o">);</span>
</pre></div>
</div>
<p>発行される SQL は次のようになります。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span> <span class="n">salary</span> <span class="o">&gt;</span> <span class="o">?</span> <span class="k">order</span> <span class="k">by</span> <span class="n">salary</span> <span class="k">asc</span><span class="p">,</span> <span class="n">employee_name</span>
</pre></div>
</div>
</div>
<div class="section" id="id13">
<h3><a class="toc-backref" href="#id35">条件コメント</a><a class="headerlink" href="#id13" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="ifend">
<h4>ifとend<a class="headerlink" href="#ifend" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>条件分岐を示す式コメントを条件コメントと呼びます。
構文は次のとおりです。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span>/*%if 条件式*/ ～ /*%end*/
</pre></div>
</div>
<p>条件式は結果が <code class="docutils literal"><span class="pre">boolean</span></code> もしくは <code class="docutils literal"><span class="pre">java.lang.Boolean</span></code> 型と評価される式でなければいけません。
例を示します。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span>
<span class="cm">/*%if employeeId != null */</span>
    <span class="n">employee_id</span> <span class="o">=</span> <span class="cm">/* employeeId */</span><span class="mi">99</span>
<span class="cm">/*%end*/</span>
</pre></div>
</div>
<p>上記の SQL 文は <code class="docutils literal"><span class="pre">employeeId</span></code> が <code class="docutils literal"><span class="pre">null</span></code> でない場合、 次のような準備された文に変換されます。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span> <span class="n">employee_id</span> <span class="o">=</span> <span class="o">?</span>
</pre></div>
</div>
<p>この SQL 文は <code class="docutils literal"><span class="pre">employeeId</span></code> が <code class="docutils literal"><span class="pre">null</span></code> の場合に次のような準備された文に変換されます。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">if</span></code> の条件が成り立たない場合に <code class="docutils literal"><span class="pre">if</span></code> の外にある WHERE句が出力されないのは、
<a class="reference internal" href="#wherehaving">条件コメントにおけるWHEREやHAVINGの自動除去</a> 機能が働いているためです。</p>
</div>
<div class="section" id="wherehaving">
<h4>条件コメントにおけるWHEREやHAVINGの自動除去<a class="headerlink" href="#wherehaving" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>条件コメントを使用した場合、条件の前にある <code class="docutils literal"><span class="pre">WHERE</span></code> や <code class="docutils literal"><span class="pre">HAVING</span></code> について自動で出力の要/不要を判定します。
たとえば、次のようなSQLで <code class="docutils literal"><span class="pre">employeeId</span></code> が <code class="docutils literal"><span class="pre">null</span></code> の場合、</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span>
<span class="cm">/*%if employeeId != null */</span>
    <span class="n">employee_id</span> <span class="o">=</span> <span class="cm">/* employeeId */</span><span class="mi">99</span>
<span class="cm">/*%end*/</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">/*%if</span> <span class="pre">～*/</span></code> の前の <code class="docutils literal"><span class="pre">where</span></code> は自動で除去され、次のSQLが生成されます。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span>
</pre></div>
</div>
</div>
<div class="section" id="andor">
<h4>条件コメントにおけるANDやORの自動除去<a class="headerlink" href="#andor" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>条件コメントを使用した場合、条件の後ろにつづく <code class="docutils literal"><span class="pre">AND</span></code> や <code class="docutils literal"><span class="pre">OR</span></code> について自動で出力の要/不要を判定します。
たとえば、次のようなSQLで <code class="docutils literal"><span class="pre">employeeId</span></code> が <code class="docutils literal"><span class="pre">null</span></code> の場合、</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span>
<span class="cm">/*%if employeeId != null */</span>
    <span class="n">employee_id</span> <span class="o">=</span> <span class="cm">/* employeeId */</span><span class="mi">99</span>
<span class="cm">/*%end*/</span>
<span class="k">and</span> <span class="n">employeeName</span> <span class="k">like</span> <span class="s1">&#39;s%&#39;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">/*%end*/</span></code> の後ろの <code class="docutils literal"><span class="pre">and</span></code> は自動で除去され、次の SQL が生成されます。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span> <span class="n">employeeName</span> <span class="k">like</span> <span class="s1">&#39;s%&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="elseifelse">
<h4>elseifとelse<a class="headerlink" href="#elseifelse" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p><code class="docutils literal"><span class="pre">/*%if</span> <span class="pre">条件式*/</span></code> と <code class="docutils literal"><span class="pre">/*%end*/</span></code> の間では、 <code class="docutils literal"><span class="pre">elseif</span></code> や <code class="docutils literal"><span class="pre">else</span></code> を表す次の構文も使用できます。</p>
<ul class="simple">
<li>/*%elseif 条件式*/</li>
<li>/*%else*/</li>
</ul>
<p>例を示します。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span>
  <span class="o">*</span>
<span class="k">from</span>
  <span class="n">employee</span>
<span class="k">where</span>
<span class="cm">/*%if employeeId != null */</span>
  <span class="n">employee_id</span> <span class="o">=</span> <span class="cm">/* employeeId */</span><span class="mi">9999</span>
<span class="cm">/*%elseif department_id != null */</span>
  <span class="k">and</span>
  <span class="n">department_id</span> <span class="o">=</span> <span class="cm">/* departmentId */</span><span class="mi">99</span>
<span class="cm">/*%else*/</span>
  <span class="k">and</span>
  <span class="n">department_id</span> <span class="k">is</span> <span class="k">null</span>
<span class="cm">/*%end*/</span>
</pre></div>
</div>
<p>上の SQL は、 <code class="docutils literal"><span class="pre">employeeId</span> <span class="pre">!=</span> <span class="pre">null</span></code>  が成立するとき実際は次の SQL に変換されます。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span>
  <span class="o">*</span>
<span class="k">from</span>
  <span class="n">employee</span>
<span class="k">where</span>
  <span class="n">employee_id</span> <span class="o">=</span> <span class="o">?</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">employeeId</span> <span class="pre">==</span> <span class="pre">null</span> <span class="pre">&amp;&amp;</span> <span class="pre">department_id</span> <span class="pre">!=</span> <span class="pre">null</span></code> が成立するとき、実際は次の SQL に変換されます。
<code class="docutils literal"><span class="pre">department_id</span></code> の直前の <code class="docutils literal"><span class="pre">AND</span></code> は自動で除去されるため出力されません。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span>
  <span class="o">*</span>
<span class="k">from</span>
  <span class="n">employee</span>
<span class="k">where</span>
  <span class="n">department_id</span> <span class="o">=</span> <span class="o">?</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">employeeId</span> <span class="pre">==</span> <span class="pre">null</span> <span class="pre">&amp;&amp;</span> <span class="pre">department_id</span> <span class="pre">==</span> <span class="pre">null</span></code> が成立するとき、実際は次の SQL に変換されます。
<code class="docutils literal"><span class="pre">department_id</span></code> の直前の <code class="docutils literal"><span class="pre">AND</span></code> は自動で除去されるため出力されません。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span>
  <span class="o">*</span>
<span class="k">from</span>
  <span class="n">employee</span>
<span class="k">where</span>
  <span class="n">department_id</span> <span class="k">is</span> <span class="k">null</span>
</pre></div>
</div>
</div>
<div class="section" id="id14">
<h4>ネストした条件コメント<a class="headerlink" href="#id14" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>条件コメントはネストさせることができます。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span>
<span class="cm">/*%if employeeId != null */</span>
  <span class="n">employee_id</span> <span class="o">=</span> <span class="cm">/* employeeId */</span><span class="mi">99</span>
  <span class="cm">/*%if employeeName != null */</span>
    <span class="k">and</span>
    <span class="n">employee_name</span> <span class="o">=</span> <span class="cm">/* employeeName */</span><span class="s1">&#39;hoge&#39;</span>
  <span class="cm">/*%else*/</span>
    <span class="k">and</span>
    <span class="n">employee_name</span> <span class="k">is</span> <span class="k">null</span>
  <span class="cm">/*%end*/</span>
<span class="cm">/*%end*/</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h4>条件コメントにおける制約<a class="headerlink" href="#id15" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>条件コメントの <code class="docutils literal"><span class="pre">if</span></code> と <code class="docutils literal"><span class="pre">end</span></code> はSQLの同じ節に含まれなければいけません。
節とは、 SELECT節、FROM節、WHERE節、GROUP BY節、HAVING節、ORDER BY節などです。
次の例では、 <code class="docutils literal"><span class="pre">if</span></code> がFROM節にあり <code class="docutils literal"><span class="pre">end</span></code> がWHERE節にあるため不正です。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="cm">/*%if employeeId != null */</span>
<span class="k">where</span> <span class="n">employee_id</span> <span class="o">=</span> <span class="cm">/* employeeId */</span><span class="mi">99</span> <span class="cm">/*%end*/</span>
</pre></div>
</div>
<p>また、 <code class="docutils literal"><span class="pre">if</span></code> と <code class="docutils literal"><span class="pre">end</span></code> は同じレベルの文に含まれなければいけません。
次の例では、 <code class="docutils literal"><span class="pre">if</span></code> が括弧の外にありendが括弧の内側にあるので不正です。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span>
<span class="k">where</span> <span class="n">employee_id</span> <span class="k">in</span> <span class="cm">/*%if departmentId != null */</span><span class="p">(...</span>  <span class="cm">/*%end*/</span> <span class="p">...)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id16">
<h3><a class="toc-backref" href="#id36">繰り返しコメント</a><a class="headerlink" href="#id16" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="forend">
<h4>forとend<a class="headerlink" href="#forend" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>繰り返しを示す式コメントを繰り返しコメントと呼びます。
構文は次のとおりです。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>/*%for 識別子 : 式*/ ～ /*%end*/
</pre></div>
</div>
<p>識別子は、繰り返される要素を指す変数です。
式は <code class="docutils literal"><span class="pre">java.lang.Iterable</span></code> 型として評価される式でなければいけません。
例を示します。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span>
<span class="cm">/*%for name : names */</span>
<span class="n">employee_name</span> <span class="k">like</span> <span class="cm">/* name */</span><span class="s1">&#39;hoge&#39;</span>
  <span class="cm">/*%if name_has_next */</span>
<span class="cm">/*# &quot;or&quot; */</span>
  <span class="cm">/*%end */</span>
<span class="cm">/*%end*/</span>
</pre></div>
</div>
<p>上記の SQL 文は、 <code class="docutils literal"><span class="pre">names</span></code> が3つの要素からなるリストを表す場合、次のような準備された文に変換されます。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span>
<span class="n">employee_name</span> <span class="k">like</span> <span class="o">?</span>
<span class="k">or</span>
<span class="n">employee_name</span> <span class="k">like</span> <span class="o">?</span>
<span class="k">or</span>
<span class="n">employee_name</span> <span class="k">like</span> <span class="o">?</span>
</pre></div>
</div>
</div>
<div class="section" id="item-has-nextitem-index">
<h4>item_has_nextとitem_index<a class="headerlink" href="#item-has-nextitem-index" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p><code class="docutils literal"><span class="pre">/*%for</span> <span class="pre">識別子</span> <span class="pre">:</span> <span class="pre">式*/</span></code> から <code class="docutils literal"><span class="pre">/*%end*/</span></code> までの内側では次の2つの特別な変数を使用できます。</p>
<ul class="simple">
<li>item_has_next</li>
<li>item_index</li>
</ul>
<p>接頭辞の <em>item</em> は識別子を表します。つまり、 <code class="docutils literal"><span class="pre">for</span></code> の識別子が <code class="docutils literal"><span class="pre">name</span></code> の場合
この変数はそれぞれ <code class="docutils literal"><span class="pre">name_has_next</span></code> と <code class="docutils literal"><span class="pre">name_index</span></code> となります。</p>
<p><code class="docutils literal"><span class="pre">item_has_next</span></code> は次の繰り返し要素が存在するかどうかを示す <code class="docutils literal"><span class="pre">boolean</span></code> の値です。</p>
<p><code class="docutils literal"><span class="pre">item_index</span></code> は繰り返しのindexを表す <code class="docutils literal"><span class="pre">int</span></code> の値です。値は0始まりです。</p>
</div>
<div class="section" id="id17">
<h4>繰り返しコメントにおけるWHEREやHAVINGの自動除去<a class="headerlink" href="#id17" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>繰り返しコメントを使用した場合、コメントの前にある
<code class="docutils literal"><span class="pre">WHERE</span></code> や <code class="docutils literal"><span class="pre">HAVING</span></code> について自動で出力の要/不要を判定します。
たとえば、次のような SQL で <code class="docutils literal"><span class="pre">names</span></code> の <code class="docutils literal"><span class="pre">size</span></code> が <code class="docutils literal"><span class="pre">0</span></code> の場合（繰り返しが行われない場合）、</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span>
<span class="cm">/*%for name : names */</span>
<span class="n">employee_name</span> <span class="k">like</span> <span class="cm">/* name */</span><span class="s1">&#39;hoge&#39;</span>
  <span class="cm">/*%if name_has_next */</span>
<span class="cm">/*# &quot;or&quot; */</span>
  <span class="cm">/*%end */</span>
<span class="cm">/*%end*/</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">/*%for</span> <span class="pre">～*/</span></code> の前の <code class="docutils literal"><span class="pre">where</span></code> は自動で除去され、次の SQL が生成されます。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span>
</pre></div>
</div>
</div>
<div class="section" id="id18">
<h4>繰り返しコメントにおけるANDやORの自動除去<a class="headerlink" href="#id18" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>繰り返しコメントを使用した場合、コメントの後ろにつづく
<code class="docutils literal"><span class="pre">AND</span></code> や <code class="docutils literal"><span class="pre">OR</span></code> について自動で出力の要/不要を判定します。
たとえば、次のような SQL で <code class="docutils literal"><span class="pre">names</span></code> の <code class="docutils literal"><span class="pre">size</span></code> が <code class="docutils literal"><span class="pre">0</span></code> の場合（繰り返しが行われない場合）、</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span>
<span class="cm">/*%for name : names */</span>
<span class="n">employee_name</span> <span class="k">like</span> <span class="cm">/* name */</span><span class="s1">&#39;hoge&#39;</span>
  <span class="cm">/*%if name_has_next */</span>
<span class="cm">/*# &quot;or&quot; */</span>
  <span class="cm">/*%end */</span>
<span class="cm">/*%end*/</span>
<span class="k">or</span>
<span class="n">salary</span> <span class="o">&gt;</span> <span class="mi">1000</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">/*%end*/</span></code> の後ろの <code class="docutils literal"><span class="pre">or</span></code> は自動で除去され、次のSQLが生成されます。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="k">where</span> <span class="n">salary</span> <span class="o">&gt;</span> <span class="mi">1000</span>
</pre></div>
</div>
</div>
<div class="section" id="id19">
<h4>繰り返しコメントにおける制約<a class="headerlink" href="#id19" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>繰り返しコメントの <code class="docutils literal"><span class="pre">for</span></code> と <code class="docutils literal"><span class="pre">end</span></code> は SQL の同じ節に含まれなければいけません。
節とは、SELECT節、FROM節、WHERE節、GROUP BY節、HAVING節、ORDER BY節などです。</p>
<p>また、 <code class="docutils literal"><span class="pre">for</span></code> と <code class="docutils literal"><span class="pre">end</span></code> は同じレベルの文に含まれなければいけません。
つまり、括弧の外で <code class="docutils literal"><span class="pre">for</span></code> 、括弧の内側で <code class="docutils literal"><span class="pre">end</span></code> という記述は認められません。</p>
</div>
</div>
<div class="section" id="id20">
<h3><a class="toc-backref" href="#id37">選択カラムリスト展開コメント</a><a class="headerlink" href="#id20" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="expand">
<h4>expand<a class="headerlink" href="#expand" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>SELECT節のアスタリスク <code class="docutils literal"><span class="pre">*</span></code> を <a class="reference internal" href="entity.html"><em>エンティティクラス</em></a> の定義を
参照して自動でカラムのリストに展開する式を選択カラムリスト展開コメントと呼びます。
構文は次のとおりです。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>/*%expand エイリアス*/
</pre></div>
</div>
<p>エイリアスは文字列として評価される式でなければいけません。
エイリアスは省略可能です。</p>
<p>このコメントの直後にはアスタリスク <code class="docutils literal"><span class="pre">*</span></code> が必須です。</p>
<p>例を示します。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="cm">/*%expand*/</span><span class="o">*</span> <span class="k">from</span> <span class="n">employee</span>
</pre></div>
</div>
<p>上記のSQL文の結果が次のような <a class="reference internal" href="entity.html"><em>エンティティクラス</em></a> にマッピングされているものとします。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>
    <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="n">Integer</span> <span class="n">age</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>このとき、 SQL は以下のように変換されます。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span> <span class="k">from</span> <span class="n">employee</span>
</pre></div>
</div>
<p>SQL 上でテーブルにエイリアスを指定する場合、
選択カラムリスト展開コメントにも同じエイリアスを指定してください。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="cm">/*%expand &quot;e&quot; */</span><span class="o">*</span> <span class="k">from</span> <span class="n">employee</span> <span class="n">e</span>
</pre></div>
</div>
<p>このとき、 SQL は以下のように変換されます。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">age</span> <span class="k">from</span> <span class="n">employee</span> <span class="n">e</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="populate">
<span id="id21"></span><h3><a class="toc-backref" href="#id38">更新カラムリスト生成コメント</a><a class="headerlink" href="#populate" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="id22">
<h4>populate<a class="headerlink" href="#id22" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>UPDATE文のSET節 を <a class="reference internal" href="entity.html"><em>エンティティクラス</em></a> の定義を
参照して自動で生成する式を更新カラムリスト生成コメントと呼びます。
構文は次のとおりです。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>/*%populate*/
</pre></div>
</div>
<p>例を示します。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">update</span> <span class="n">employee</span> <span class="k">set</span> <span class="cm">/*%populate*/</span> <span class="n">id</span> <span class="o">=</span> <span class="n">id</span> <span class="k">where</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">30</span>
</pre></div>
</div>
<p>上記のSQL文への入力が次のような <a class="reference internal" href="entity.html"><em>エンティティクラス</em></a> にマッピングされているものとします。</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>
    <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="n">Integer</span> <span class="n">age</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>このとき、 SQL は以下のように変換されます。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">update</span> <span class="n">employee</span> <span class="k">set</span> <span class="n">id</span> <span class="o">=</span> <span class="o">?</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="o">?</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="o">?</span> <span class="k">where</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">30</span>
</pre></div>
</div>
<p>更新カラムリスト生成コメントは、 <code class="docutils literal"><span class="pre">/*%populate*/</span></code> からWHERE句までをカラムリストで置き換えます。
つまり、元のSQLにあった <code class="docutils literal"><span class="pre">id</span> <span class="pre">=</span> <span class="pre">id</span></code> の記述は最終的なSQLからは削除されます。</p>
</div>
</div>
<div class="section" id="id23">
<h3><a class="toc-backref" href="#id39">通常のブロックコメント</a><a class="headerlink" href="#id23" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><code class="docutils literal"><span class="pre">/*</span></code> の直後に続く3文字目がJavaの識別子の先頭で使用できない文字
（ただし、空白および式で特別な意味をもつ <code class="docutils literal"><span class="pre">%</span></code>、<code class="docutils literal"><span class="pre">#</span></code>、 <code class="docutils literal"><span class="pre">&#64;</span></code>、 <code class="docutils literal"><span class="pre">&quot;</span></code>、 <code class="docutils literal"><span class="pre">'</span></code> は除く）の場合、
それは通常のブロックコメントだとみなされます。</p>
<p>たとえば、次の例はすべて通常のブロックコメントです。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="cm">/**～*/</span>
<span class="cm">/*+～*/</span>
<span class="cm">/*=～*/</span>
<span class="cm">/*:～*/</span>
<span class="cm">/*;～*/</span>
<span class="cm">/*(～*/</span>
<span class="cm">/*)～*/</span>
<span class="cm">/*&amp;～*/</span>
</pre></div>
</div>
<p>一方、次の例はすべて式コメントだとみなされます。</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="cm">/* ～*/</span> <span class="p">...</span><span class="c1">--3文字目が空白であるため式コメントです。</span>
<span class="cm">/*a～*/</span> <span class="p">...</span><span class="c1">--3文字目がJavaの識別子の先頭で使用可能な文字であるため式コメントです。</span>
<span class="cm">/*$～*/</span> <span class="p">...</span><span class="c1">--3文字目がJavaの識別子の先頭で使用可能な文字であるため式コメントです。</span>
<span class="cm">/*%～*/</span> <span class="p">...</span><span class="c1">--3文字目が条件コメントや繰り返しコメントの始まりを表す「%」であるため式コメントです。</span>
<span class="cm">/*#～*/</span> <span class="p">...</span><span class="c1">--3文字目が埋め込み変数コメントを表す「#」であるため式コメントです。</span>
<span class="cm">/*@～*/</span> <span class="p">...</span><span class="c1">--3文字目が組み込み関数もしくはクラス名を表す「@」であるため式コメントです。</span>
<span class="cm">/*&quot;～*/</span> <span class="p">...</span><span class="c1">--3文字目が文字列リテラルの引用符を表す「&quot;」であるため式コメントです。</span>
<span class="cm">/*&#39;～*/</span> <span class="p">...</span><span class="c1">--3文字目が文字リテラルの引用符を表す「&#39;」であるため式コメントです。</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">特に理由がない場合、通常のブロックコメントには
最初のアスタリスクを2つ重ねる <code class="docutils literal"><span class="pre">/**～*/</span></code> を使用するのがよいでしょう。</p>
</div>
</div>
<div class="section" id="id24">
<h3><a class="toc-backref" href="#id40">通常の行コメント</a><a class="headerlink" href="#id24" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><code class="docutils literal"><span class="pre">--</span></code> は通常の行コメントだとみなされます。</p>
<p>Domaでは行コメントを特別に解釈することはありません。</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="expression.html" class="btn btn-neutral float-right" title="式言語" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="query-builder/index.html" class="btn btn-neutral" title="クエリビルダ" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Toshihiro Nakamura.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>